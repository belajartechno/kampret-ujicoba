<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Dashboard Karyawan</title>
  <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;500&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
  <style>
    :root { --primary:#4CAF50; --secondary:#2196F3; --danger:#f44336; --light:#f4f4f4; --white:#fff; }
    body { font-family: Roboto, sans-serif; background: var(--light); margin:0; padding:20px; color:#333; }
    .login-form, .card { background: var(--white); padding:20px; border-radius:10px; box-shadow:0 2px 6px rgba(0,0,0,.1); margin-bottom:20px; }
    .login-form { max-width:480px; margin:60px auto; text-align:center; }
    input,select { width:100%; padding:10px; margin:8px 0; border:1px solid #ddd; border-radius:6px; }
    button { padding:8px 12px; border:none; border-radius:6px; cursor:pointer; }
    .btn-primary { background:var(--primary); color:#fff; }
    .btn-secondary { background:var(--secondary); color:#fff; }
    .btn-danger { background:var(--danger); color:#fff; }
    header.app-header { background:var(--primary); color:#fff; padding:12px; border-radius:8px; display:flex; justify-content:space-between; align-items:center; }
    table { width:100%; border-collapse:collapse; margin-top:12px; }
    th,td { border:1px solid #ddd; padding:8px; text-align:center; }
    th { background:var(--primary); color:#fff; }
    .action-buttons { display:flex; gap:8px; justify-content:center; }
    .preview-img { max-width:60px; max-height:60px; border-radius:6px; }
    .error-msg { color: red; font-size: 0.9em; margin-top: 6px; }
  </style>
</head>
<body>
  <div id="loginScreen" class="login-form">
    <h2><i class="fas fa-user-lock"></i> Login Sistem</h2>
    <p>Pilih peran: User/Operator (input saja) atau Admin (edit & hapus)</p>
    <select id="role">
      <option value="user">User / Operator</option>
      <option value="admin">Admin</option>
    </select>
    <input id="username" type="text" placeholder="Username">
    <input id="password" type="password" placeholder="Password">
    <button id="loginBtn" class="btn-primary">Masuk</button>
    <div id="loginError" class="error-msg"></div>
  </div>

  <div id="mainApp" style="display:none;">
    <header class="app-header">
      <h3><i class="fas fa-building"></i> Dashboard Karyawan</h3>
      <div style="display:flex;gap:12px;align-items:center;">
        <div id="roleLabel"></div>
        <button id="logoutBtn" class="btn-danger">Keluar</button>
      </div>
    </header>

    <div class="card">
      <h3 id="formTitle">Tambah Karyawan</h3>
      <input type="hidden" id="editId">
      <input type="text" id="nama" placeholder="Nama Lengkap">
      <input type="text" id="nik" placeholder="NIK (16 digit)" maxlength="16">
      <input type="text" id="telepon" placeholder="Nomor Telepon (maks 13 digit)" maxlength="13">
      <select id="alamat">
        <option value="">Pilih Wilayah</option>
        <option value="Bandar Lampung">Bandar Lampung</option>
        <option value="Metro">Metro</option>
        <option value="Lampung Selatan">Lampung Selatan</option>
        <option value="Lampung Tengah">Lampung Tengah</option>
        <option value="Lampung Utara">Lampung Utara</option>
        <option value="Way Kanan">Way Kanan</option>
        <option value="Tulang Bawang">Tulang Bawang</option>
        <option value="Tulang Bawang Barat">Tulang Bawang Barat</option>
        <option value="Mesuji">Mesuji</option>
        <option value="Pesawaran">Pesawaran</option>
        <option value="Pringsewu">Pringsewu</option>
        <option value="Tanggamus">Tanggamus</option>
        <option value="Pesisir Barat">Pesisir Barat</option>
        <option value="Lampung Barat">Lampung Barat</option>
        <option value="Lampung Timur">Lampung Timur</option>
      </select>
      <input type="date" id="mulai">
      <select id="pendidikan">
        <option value="">Pilih Pendidikan</option>
        <option value="SMA/SMK/MA">SMA/SMK/MA</option>
        <option value="Sarjana">Sarjana</option>
        <option value="Magister">Magister</option>
        <option value="Doktor">Doktor</option>
        <option value="Profesor">Profesor</option>
      </select>
      <select id="jabatan">
        <option value="">Pilih Jabatan</option>
        <option value="Direktur">Direktur</option>
        <option value="Manajer">Manajer</option>
        <option value="Teller">Teller</option>
        <option value="Accounting">Accounting</option>
        <option value="Account Officer">Account Officer</option>
        <option value="Customer Service">Customer Service</option>
        <option value="Marketing">Marketing</option>
      </select>
      <select id="status">
        <option value="">Pilih Status</option>
        <option value="Aktif">Aktif</option>
        <option value="Non Aktif">Non Aktif</option>
        <option value="Nonjob">Nonjob</option>
        <option value="Resign">Resign</option>
        <option value="Lainnya">Lainnya</option>
      </select>
      <label>Upload File:</label>
      <input type="file" id="fileUpload">
      <label>Upload Foto:</label>
      <input type="file" id="imgUpload" accept="image/*">
      <div style="margin-top:12px;display:flex;gap:8px;justify-content:flex-end;">
        <button id="clearBtn" class="btn-secondary">Clear</button>
        <button id="saveBtn" class="btn-primary">Simpan</button>
      </div>
    </div>

    <div class="card">
      <div style="display:flex;justify-content:space-between;align-items:center;">
        <input id="searchInput" type="text" placeholder="Cari karyawan...">
        <div>
          <button id="printBtn" class="btn-secondary">Cetak PDF</button>
          <button id="exportBtn" class="btn-primary">Export Excel</button>
        </div>
      </div>
      <table id="karyawanTable">
        <thead><tr>
          <th>Nama</th><th>NIK</th><th>Alamat</th><th>Telepon</th><th>Pendidikan</th><th>Jabatan</th><th>Status</th><th>File</th><th>Foto</th><th>Aksi</th>
        </tr></thead>
        <tbody></tbody>
      </table>
    </div>

    <div class="card">
      <h3>Statistik Karyawan per Wilayah</h3>
      <canvas id="statsChart" height="100"></canvas>
    </div>
  </div>

  <script>
    const ADMIN_USER = "admin", ADMIN_PASS = "admin123";
    const USER_USER = "user", USER_PASS = "user123";

    let currentRole = "";
    let allData = [];
    let chart = null;

    function login() {
      const role = document.getElementById('role').value;
      const u = document.getElementById('username').value.trim();
      const p = document.getElementById('password').value.trim();
      const err = document.getElementById('loginError');
      err.textContent = "";

      if (role === 'admin' && u.toLowerCase()===ADMIN_USER && p===ADMIN_PASS) {
        currentRole='admin';
      } else if (role==='user' && u.toLowerCase()===USER_USER && p===USER_PASS) {
        currentRole='user';
      } else {
        err.textContent = 'Login gagal! Username atau password salah.';
        return;
      }

      document.getElementById('loginScreen').style.display='none';
      document.getElementById('mainApp').style.display='block';
      document.getElementById('roleLabel').textContent = 'Peran: ' + currentRole.toUpperCase();
      loadLocalData();
      renderAll();
    }

    function logout() { location.reload(); }
    function loadLocalData(){ allData = JSON.parse(localStorage.getItem('karyawanData'))||[]; }
    function saveLocalData(){ localStorage.setItem('karyawanData', JSON.stringify(allData)); }

    function simpanKaryawan(){
      const nama=document.getElementById('nama').value.trim();
      const nik=document.getElementById('nik').value.trim();
      const alamat=document.getElementById('alamat').value;
      const telepon=document.getElementById('telepon').value.trim();
      const mulai=document.getElementById('mulai').value;
      const pendidikan=document.getElementById('pendidikan').value;
      const jabatan=document.getElementById('jabatan').value;
      const status=document.getElementById('status').value;
      const f=document.getElementById('fileUpload');
      const img=document.getElementById('imgUpload');
      const fileName=f.files.length?f.files[0].name:'';
      const imgFile=img.files.length?URL.createObjectURL(img.files[0]):'';
      const editId=document.getElementById('editId').value;
      if(!nama||!nik){alert('Nama dan NIK wajib diisi');return;}
      if(!/^[0-9]{16}$/.test(nik)){alert('NIK harus 16 digit');return;}
      if(telepon&&(!/^[0-9]+$/.test(telepon)||telepon.length>13)){alert('Telepon maksimal 13 digit');return;}
      const item={nama,nik,alamat,telepon,mulai,pendidikan,jabatan,status,fileName,imgFile};
      if(editId!==''){const i=parseInt(editId,10);if(!isNaN(i)){allData[i]=item;}} else allData.push(item);
      saveLocalData(); clearForm(); renderAll();
    }

    function clearForm(){ ['nama','nik','alamat','telepon','mulai','pendidikan','jabatan','status','fileUpload','imgUpload','editId'].forEach(id=>{const el=document.getElementById(id); if(el) el.value='';}); document.getElementById('formTitle').textContent='Tambah Karyawan'; }

    function renderAll(){ renderRows(allData); renderChart(); }
    function renderRows(list){
      const tbody=document.querySelector('#karyawanTable tbody'); tbody.innerHTML='';
      list.forEach((it,i)=>{
        const tr=document.createElement('tr');
        tr.innerHTML=`<td>${it.nama}</td><td>${it.nik}</td><td>${it.alamat||'-'}</td><td>${it.telepon||'-'}</td><td>${it.pendidikan||'-'}</td><td>${it.jabatan||'-'}</td><td>${it.status||'-'}</td><td>${it.fileName||'-'}</td><td>${it.imgFile?`<img src="${it.imgFile}" class='preview-img'/>`:'-'}</td>`;
        const td=document.createElement('td');
        if(currentRole==='admin'){
          const wrap=document.createElement('div');wrap.className='action-buttons';
          const b1=document.createElement('button');b1.textContent='Edit';b1.className='btn-secondary'; b1.onclick=()=>editKaryawan(i);
          const b2=document.createElement('button');b2.textContent='Hapus';b2.className='btn-danger'; b2.onclick=()=>hapusKaryawan(i);
          wrap.appendChild(b1);wrap.appendChild(b2);td.appendChild(wrap);
        } else td.textContent='-';
        tr.appendChild(td); tbody.appendChild(tr);
      });
    }

    function hapusKaryawan(i){
      if(i<0||i>=allData.length)return;
      if(confirm('Hapus data ini?')){
        allData.splice(i,1);
        saveLocalData();
        renderAll();
      }
    }

    function editKaryawan(i){ if(i<0||i>=allData.length) return; const x=allData[i]; document.getElementById('editId').value=i; document.getElementById('nama').value=x.nama||''; document.getElementById('nik').value=x.nik||''; document.getElementById('alamat').value=x.alamat||''; document.getElementById('telepon').value=x.telepon||''; document.getElementById('mulai').value=x.mulai||''; document.getElementById('pendidikan').value=x.pendidikan||''; document.getElementById('jabatan').value=x.jabatan||''; document.getElementById('status').value=x.status||''; document.getElementById('formTitle').textContent='Edit Karyawan'; }

    function searchKaryawan(){ const q=document.getElementById('searchInput').value.toLowerCase(); const f=allData.filter(r=> (r.nama||'').toLowerCase().includes(q)||(r.nik||'').includes(q)||(r.alamat||'').toLowerCase().includes(q)||(r.telepon||'').includes(q)||(r.jabatan||'').toLowerCase().includes(q)); renderRows(f); renderChart(f); }

    function renderChart(src){ const list=Array.isArray(src)?src:allData; const c={}; list.forEach(r=>{const k=r.alamat||'Tidak Ada';c[k]=(c[k]||0)+1}); const labels=Object.keys(c).length?Object.keys(c):['Tidak Ada']; const values=Object.values(c).length?Object.values(c):[0]; const ctx=document.getElementById('statsChart').getContext('2d'); if(chart) chart.destroy(); chart=new Chart(ctx,{type:'bar',data:{labels,datasets:[{label:'Jumlah Karyawan',data:values,backgroundColor:'#4CAF50'}]},options:{responsive:true,scales:{y:{beginAtZero:true}}}}); }

    function cetakData(){ const d=allData||[]; let rows=''; d.forEach(it=>{rows+=`<tr><td>${it.nama}</td><td>${it.nik}</td><td>${it.alamat}</td><td>${it.telepon}</td><td>${it.pendidikan}</td><td>${it.jabatan}</td><td>${it.status}</td></tr>`;}); const html=`<!doctype html><html><head><meta charset='utf-8'><title>Cetak</title><style>table{width:100%;border-collapse:collapse}th,td{border:1px solid #333;padding:6px;text-align:center}th{background:#4CAF50;color:#fff}</style></head><body><h2>Data Karyawan</h2><table><thead><tr><th>Nama</th><th>NIK</th><th>Alamat</th><th>Telepon</th><th>Pendidikan</th><th>Jabatan</th><th>Status</th></tr></thead><tbody>${rows}</tbody></table></body></html>`; const url='data:text/html;charset=utf-8,'+encodeURIComponent(html); const w=window.open(url,'_blank'); if(w)w.onload=()=>w.print(); }

    function exportToExcel(){ const data=(allData||[]).map(it=>({Nama:it.nama,NIK:it.nik,Alamat:it.alamat,Telepon:it.telepon,Pendidikan:it.pendidikan,Jabatan:it.jabatan,Status:it.status})); const ws=XLSX.utils.json_to_sheet(data); const wb=XLSX.utils.book_new(); XLSX.utils.book_append_sheet(wb,ws,'Karyawan'); XLSX.writeFile(wb,'Data-Karyawan
